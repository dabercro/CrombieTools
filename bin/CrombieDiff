#!/usr/bin/python

import os, sys
import argparse

sys.path.insert(0, os.environ['CROMBIEPATH'] + '/scripts')

from CrombieTreeFinder import GetNumEntries

parser = argparse.ArgumentParser(description = 'Checks two directories to make sure they have the same number of files' + 
                                               ' and number of events in the tree and hist for each file')

parser.add_argument('dirs', metavar='DIRECTORY', nargs=2, help='The names of the two directories to compare.')

args = parser.parse_args()

for fileName in os.listdir(args.dirs[1]):
    if '.root' not in fileName:
        continue

    if not os.path.exists(args.dirs[0] + '/' + fileName):
        print(fileName + ' is in ' + args.dirs[1] + ', but not in ' + args.dirs[0])

print('\nGoing on to compare number of events:         ' + args.dirs[0] + ' --to-- ' + args.dirs[1] + '\n')

for fileName in os.listdir(args.dirs[0]):
    if '.root' not in fileName:
        continue

    if not os.path.exists(args.dirs[1] + '/' + fileName):
        print(fileName + ' is in ' + args.dirs[0] + ', but not in ' + args.dirs[1])

    else:
        tree0 = GetNumEntries(args.dirs[0] + '/' + fileName, 'TTree')
        tree1 = GetNumEntries(args.dirs[1] + '/' + fileName, 'TTree')
        if tree0 != tree1:
            print(fileName + ' has different number of events in trees: ' + str(tree0) + '     ' + str(tree1))

        hist0 = GetNumEntries(args.dirs[0] + '/' + fileName, 'TH1')
        hist1 = GetNumEntries(args.dirs[1] + '/' + fileName, 'TH1')
        if hist0 != hist1:
            print(fileName + ' has different number of events in hists: ' + str(hist0) + '     ' + str(hist1))
