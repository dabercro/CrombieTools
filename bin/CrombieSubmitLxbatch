#! /bin/bash

fresh=$1

if [ "$CMSSW_BASE" = "" ]
then
    echo "CMSSW_BASE not set. Make sure to cmsenv someplace that you want the jobs to use"
    exit
fi

if [ ! -d bout ]
then
    mkdir bout
fi

source CrombieConfig

$CROMBIEPATH/scripts/./CrombieDumpFileList.sh eos

rootNames=`ls $CrombieTempDir/monojet_*_*.txt | sed 's/.txt/.root/'`
    
for outFile in $rootNames
do
    if [ ! -f $outFile -o "$fresh" = "fresh" ]
    then
        echo Making: $outFile
        if [ "$fresh" = "test" ]
        then
            echo bsub -q $CrombieQueue -n $CrombieNumberProcs -o bout/out.%J $CROMBIEPATH/scripts/CrombieDoJob.sh $CMSSW_BASE $PWD $outFile $CrombieNumberProcs $CrombieSlimmerScript $CrombieJobScriptList
        else
            bsub -q $CrombieQueue -n $CrombieNumberProcs -o bout/out.%J $CROMBIEPATH/scripts/CrombieDoJob.sh $CMSSW_BASE $PWD $outFile $CrombieNumberProcs $CrombieSlimmerScript $CrombieJobScriptList
        fi
        ranOnFile=1
    fi
done

if [ "$ranOnFile" -eq 0 ]
then
    cat $haddFile | xargs -n2 -P6 $CROMBIEPATH/scripts/./haddArgs.sh 
    echo "All files merged!"
fi
